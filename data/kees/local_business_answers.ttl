@prefix graph: <https://hub2.linkeddata.center/sd1lodmap/graph/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix kees: <http://linkeddata.center/kees/v1#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix resource: <http://data.econocom.it/resource/> .


resource:local_business:unknow_location a kees:Table ;
	dct:identifier "local_business:unknow_location" ;
	rdfs:label "Business entities without a recognized city."@en ;
	rdfs:comment "Business entities with an address that does'nt match ISTAT classification"@en ;
	kees:queryText """# Business entities with an address that does'nt match ISTAT classification
PREFIX schema: <http://schema.org/> 

SELECT ?dataset ?azienda ?comune ?provincia
WHERE { 
	GRAPH ?dataset { ?azienda schema:address  ?address }
	
	OPTIONAL { ?address schema:addressLocality ?comune }
	OPTIONAL { ?address schema:addressRegion ?provincia }
    OPTIONAL { 
      ?azienda schema:containedInPlace ?city.
      ?city a schema:City;
    }
  
  	FILTER( !BOUND(?city) )
}
""" 
.


resource:local_business:id a kees:Table ;
	dct:identifier "local_business:id" ;
	rdfs:label "Info about a specific id (in %ID% parameter)."@en ;
	rdfs:comment "Display name, address and identities for a company whose id contains the string specified in %ID% parameter. Just firts 50 entries displayed."@en ;
	kees:queryText """# Display name, address and identities for a company whose id contains the string specified in %ID% parameter. Just firts 50 entries displayed.
PREFIX schema: <http://schema.org/>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT ?graph ?uri ?name ?address ?sameAs 
WHERE {
  GRAPH ?graph { ?uri a schema:LocalBusiness; dct:identifier ?id } .
  ?uri schema:alternateName ?name .
  OPTIONAL { ?uri schema:address [ schema:description ?address ] }
  OPTIONAL { ?uri owl:sameAs ?sameAs }
  FILTER( CONTAINS( ?id, "%ID=0%" ) )
} LIMIT 50
""" 
.

resource:local_business:same_as a kees:Table ;
	dct:identifier "local_business:same_as" ;
	rdfs:label "Business entities identities."@en ;
	rdfs:comment "Business entities that could be identical to other business entities"@en ;
	kees:queryText """# Business entities that could be identical to other business entities
PREFIX schema: <http://schema.org/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT DISTINCT ?s1 ?s2 ?found_in_graph
WHERE {
 ?s1 a schema:LocalBusiness .
 ?s2 a schema:LocalBusiness .
  
  GRAPH ?found_in_graph { ?s1 owl:sameAs ?s2. }
  FILTER ( ?s1 != ?s2)
} ORDER BY ?s1
""" 
.




